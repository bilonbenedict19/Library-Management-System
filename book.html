<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Tickets</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .seat-checkbox { width: 30px; height: 30px; }
        .seat-label { display: inline-block; width: 30px; text-align: center; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1>Book Tickets for {{ movie['title'] }}</h1>
    <form method="post">
        <div class="mb-3">
            <label for="showtime" class="form-label">Showtime:</label>
            <select name="showtime" class="form-select" required>
                <option value="">Select a showtime</option>
                {% for show in showtimes %}
                    <option value="{{ show['id'] }}" {% if show['id'] == (request.form.get('showtime')|int) or show['id'] == (request.args.get('showtime')|int) %}selected{% endif %}>{{ show['time'] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="tickets" class="form-label">Number of Tickets:</label>
            <input type="number" class="form-control" name="tickets" id="tickets" min="1" max="25" value="{{ request.form.get('tickets', 1) }}" required onchange="updateTotal()">
        </div>
        <div class="mb-3">
            <label class="form-label">Price per Ticket:</label>
            <input type="text" class="form-control" value="₱{{ movie['price'] }}" readonly>
        </div>
        <div class="mb-3">
            <label class="form-label">Total to Pay:</label>
            <input type="text" class="form-control" id="totalPay" value="₱{{ movie['price'] * (request.form.get('tickets', 1)|int) }}" readonly>
        </div>
        {% if not available_seats %}
            <button type="submit" class="btn btn-primary">Show Available Seats</button>
        {% else %}
        <div class="mb-3">
            <label for="name" class="form-label">Your Name:</label>
            <input type="text" class="form-control" name="name" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Select Seats (choose {{ request.form.get('tickets', 1)|int }}):</label>
            <div>
                <table>
                {% for row in ['A','B','C','D','E'] %}
                    <tr>
                    {% for col in ['1','2','3','4','5'] %}
                        {% set seat_label = row ~ col %}
                        <td>
                            {% if seat_label in seat_map[row] %}
                                <input type="checkbox" class="seat-checkbox" name="seats" value="{{ seat_label }}">
                                <span class="seat-label">{{ seat_label }}</span>
                            {% else %}
                                <span class="seat-label text-muted">{{ seat_label }}</span>
                            {% endif %}
                        </td>
                    {% endfor %}
                    </tr>
                {% endfor %}
                </table>
            </div>
        </div>
        <h3>Payment Information</h3>
        <div class="mb-3">
            <label for="card_number" class="form-label">Card Number:</label>
            <input type="text" class="form-control" name="card_number" required>
        </div>
        <div class="mb-3">
            <label for="card_name" class="form-label">Name on Card:</label>
            <input type="text" class="form-control" name="card_name" required>
        </div>
        <button type="submit" class="btn btn-success">Pay & Book</button>
        {% endif %}
    </form>
</div>
<script>
    function updateTotal() {
        var price = Number("{{ movie['price'] }}");
        var tickets = document.getElementById('tickets').value;
        var total = price * tickets;
        document.getElementById('totalPay').value = '₱' + total;
    }
</script>
</body>
</html>
